<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:smtk="http://java.sun.com/jsf/composite/smtk"
                template="/WEB-INF/template/template.xhtml">

    <ui:define name="content">

        <p:panel id="createEdit">
        <h:form id="mainForm" rendered="#{newConceptMBean.concept!=null}">

            <p:growl id="growl" showDetail="true" showSummary="true"/>
            <p:growl id="editMsgs" showDetail="true"/>
            <!--p:messages autoUpdate="true"></p:messages-->
            <h3>Responsive</h3>

            <div class="ui-g">
                <div class="ui-g-12 ui-md-6 ui-lg-1">
                    <p:outputLabel for="check" value="Indicadores"/>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-5">
                    <p:selectManyCheckbox id="check" layout="responsive" columns="2" style="width:60%">
                        <f:selectItem itemLabel="Revisar" itemValue="#{newConceptMBean.concept.toBeReviewed}"/>
                        <f:selectItem itemLabel="Consultar" itemValue="#{newConceptMBean.concept.toBeConsultated}"/>
                    </p:selectManyCheckbox>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                </div>
            </div>

            <div class="ui-g">
                <div class="ui-g-12 ui-md-6 ui-lg-1">
                    <p:outputLabel for="FSN" value="FSN"/>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-5">
                    <p:inputText id="FSN" name="FSN"
                                 required="true"
                                 style="width:90%" value="#{newConceptMBean.FSN}"/>
                    <p:message for="FSN" display="tooltip" ></p:message>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                    <p:selectOneRadio id="FSNCaseSensitive"
                                      layout="responsive" columns="2" style="width:100%">
                        <f:selectItem itemValue="#{true}" itemLabel="Sensible"/>
                        <f:selectItem itemValue="#{false}" itemLabel="Insensible"/>
                    </p:selectOneRadio>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                    <p:selectBooleanCheckbox id="FSNCAutogeneratedName" itemLabel="autogenerado" layout="responsive"
                                             columns="2"  />
                </div>
            </div>

            <div class="ui-g">
                <div class="ui-g-12 ui-md-6 ui-lg-1">
                    <p:outputLabel for="preferido" value="Preferido"/>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-5">
                    <p:inputText id="preferido" onkeyup="autogenerate(this)"  value="#{newConceptMBean.concept.descriptionFavorite.term}"
                                 required="true"
                                 style="width:90%"/>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                    <p:selectOneRadio id="preferidoCaseSensitive"
                                      value="#{newConceptMBean.concept.descriptionFavorite.caseSensitive}" layout="responsive"
                                      columns="2" style="width:100%">
                        <f:selectItem itemValue="#{true}" itemLabel="Sensible"/>
                        <f:selectItem itemValue="#{false}" itemLabel="Insensible"/>
                    </p:selectOneRadio>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-3">
                </div>
            </div>

            <p:panel id="toggleable" header="Otros Descriptores" toggleable="true" toggleSpeed="500" closeSpeed="500"
                     widgetVar="panel" style="margin-bottom:20px">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                        <p:outputLabel for="otherTermino" value="Termino (*)"/>
                    </div>

                    <div class="ui-g-12 ui-md-6 ui-lg-5">
                        <p:inputText id="otherTermino" value="#{newConceptMBean.otherTermino}" style="width:90%"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <p:selectOneRadio id="radio4" value="#{newConceptMBean.otherSensibilidad}" layout="responsive"
                                          columns="2" style="width:100%">
                            <f:selectItem itemValue="#{true}" itemLabel="Sensible"/>
                            <f:selectItem itemValue="#{false}" itemLabel="Insensible"/>
                        </p:selectOneRadio>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:selectOneMenu id="console" value="#{newConceptMBean.otherDescriptionType}"
                                         converter="descriptionTypeConverter"
                                         style="width:70%">

                            <f:selectItems value="#{newConceptMBean.descriptionTypes}" var="descriptionType"
                                           itemLabel="#{descriptionType.name}" itemValue="#{descriptionType}"/>

                        </p:selectOneMenu>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                        <p:commandButton value="Agregar" id="btn"  action="#{newConceptMBean.addDescription}"
                                         update="otherDescriptions" styleClass="ui-priority-primary"
                                         style="float: right"/>
                    </div>
                </div>
                <div class="ui-g">
                    <p:dataTable id="otherDescriptions"
                                 var="description"
                                 value="#{newConceptMBean.concept.descriptions}"
                                 editable="true"
                                 selection="#{newConceptMBean.selectedDescriptions}"
                                 rowKey="#{description.id}"
                                 reflow="true">

                        <p:ajax event="rowEdit" listener="#{newConceptMBean.onRowEdit}" update=":mainForm:editMsgs"/>
                        <p:ajax event="rowEditCancel" listener="#{newConceptMBean.onRowCancel}"
                                update=":mainForm:editMsgs"/>

                        <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                        <p:column headerText="Set/DescId" style="width:5%">
                            <div style="text-align: center;">
                                <h:outputText value="-"/>
                            </div>
                        </p:column>

                        <p:column headerText="Término">
                            <div style="text-align: center;">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{description.term}"/></f:facet>
                                    <f:facet name="input"><p:inputText id="otrasTermino" value="#{description.term}"
                                                                       style="width:100%"/></f:facet>
                                </p:cellEditor>
                            </div>
                        </p:column>

                        <p:column headerText="Estado">
                            <div style="text-align: center;">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{description.state}"/></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{description.state}"
                                                         converter="omnifaces.SelectItemsConverter" style="width:100%">
                                            <f:selectItem itemLabel="Seleccione estado" itemValue=""/>
                                            <f:selectItems
                                                    value="#{newConceptMBean.stateMachineManager.conceptStateMachine.getTargetStates(newConceptMBean.concept.state)}"
                                                    var="descriptionState" itemLabel="#{descriptionState.name}"
                                                    itemValue="#{descriptionState}"/>
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </div>
                        </p:column>

                        <p:column headerText="Tipo Descriptor">
                            <div style="text-align: center;">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText
                                            value="#{description.descriptionType}"/></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{description.descriptionType}"
                                                         converter="omnifaces.SelectItemsConverter" style="width:100%">
                                            <f:selectItem itemLabel="Seleccione tipo" itemValue=""/>
                                            <f:selectItems value="#{newConceptMBean.descriptionTypes}"
                                                           var="descriptionType" itemLabel="#{descriptionType.name}"
                                                           itemValue="#{descriptionType}"/>
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </div>
                        </p:column>

                        <p:column headerText="Fecha Creación">
                            <div style="text-align: center;">
                                <h:outputText />
                            </div>
                        </p:column>

                        <p:column headerText="Sensibilidad">
                            <div style="text-align: center;">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="Sensible" rendered="#{description.caseSensitive}"/>
                                        <h:outputText value="Insensible" rendered="#{!description.caseSensitive}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{description.caseSensitive}" style="width:100%">
                                            <f:selectItem itemValue="#{true}" itemLabel="Sensible"/>
                                            <f:selectItem itemValue="#{false}" itemLabel="Insensible"/>
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </div>
                        </p:column>

                        <p:column headerText="Usuario Creador">
                            <div style="text-align: center;">
                                <h:outputText />
                            </div>
                        </p:column>

                        <p:column headerText="Acción" style="width:5%">
                            <p:commandLink actionListener="#{newConceptMBean.removeItem(description)}" ajax="true"
                                           update="otherDescriptions" style="float: right">
                                <h:graphicImage  style="width: 15px; height: 15px"
                                                 name="images/trash-blue.png"
                                />
                            </p:commandLink>
                            <p:rowEditor style="display: inline"/>
                        </p:column>
                    </p:dataTable>
                </div>
            </p:panel>

            <!--Relaciones -->
            <p:panel id="atributos" header="Atributos" toggleable="true" toggleSpeed="500" closeSpeed="500"
                     widgetVar="panelAtributos" style="margin-bottom:20px" >

            <h:dataTable style="width: 100%;" value="#{newConceptMBean.category.relationshipDefinitions}"
                         var="relationshipDefinition">

                <h:column>
                    <smtk:basicType
                            targetDefinition="#{relationshipDefinition.targetDefinition}"
                            relationshipDefinition="#{relationshipDefinition}"
                            concept="#{newConceptMBean.concept}"
                            rendered="#{relationshipDefinition.targetDefinition.basicType}"

                    />

                    <smtk:smtkType rendered="#{relationshipDefinition.targetDefinition.SMTKType}"
                                   targetDefinition="#{relationshipDefinition.targetDefinition}"
                                   relationshipDefinition="#{relationshipDefinition}"
                    />

                    <smtk:helperTableType
                                          rendered="#{relationshipDefinition.targetDefinition.helperTable}"
                                          relationshipDefinition="#{relationshipDefinition}"
                                          targetDefinition="#{relationshipDefinition.targetDefinition}"
                                          concept="#{newConceptMBean.concept}"
                    />

                </h:column>
            </h:dataTable>
        </p:panel>


            <p:commandButton actionListener="#{newConceptMBean.saveConcept}" value="Guardar" type="submit" update="growl"

            />

        </h:form>

        <p:messages id="msg" showDetail="true" showSummary="true">
            <p:effect type="pulsate" event="load" delay="0">
                <f:param name="mode" value="'show'"/>
                <f:param name="times" value="'1'"/>
            </p:effect>
        </p:messages>


        <p:confirmDialog id="dialogNameConcept" header="Crear Concepto" widgetVar="dialogNameConcept" global="true"
                         showEffect="fade" hideEffect="fade" closable="false"
                         rendered="#{newConceptMBean.concept==null}">
            <h:form id="initialForm" >
                <h:outputText value="Ingrerse el nombre de su concepto:"/>
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-6 ui-lg-12">
                        <p:outputLabel value="Nombre: " for="NameConcept"/>
                        <p:inputText id="NameConcept" value="#{newConceptMBean.favoriteDescription}"/>
                    </div>
                </div>
                <p:commandButton actionListener="#{newConceptMBean.createConcept}" update=":createEdit"
                                 value="Siguiente" onclick="loadAutogenerate()"

                />

            </h:form>
        </p:confirmDialog>
        </p:panel>


        <script type="text/javascript">

            function loadAutogenerate(){

                setTimeout(function() {
                    autogenerate(document.getElementById('initialForm:NameConcept'));
                }, 1000);
            }
             function autogenerate(favorite){
                 categoryName= "#{newConceptMBean.category.name}";
                 document.getElementById('mainForm:FSN').value=favorite.value+' ('+categoryName+')';


             }

        </script>

    </ui:define>

</ui:composition>