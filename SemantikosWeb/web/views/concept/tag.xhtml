<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/WEB-INF/template/template.xhtml">

    <ui:define name="content">
        <p:panel id="findConcept">
            <h:form id="tags">
                <p:spacer></p:spacer>
                <h3>Crear tag</h3>
                <p:panel id="create">

                    <div class="ui-g">

                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                            <p:autoComplete id="parentTag" scrollHeight="200" size="5" style="width: 80%;"
                                            inputStyle="width: 80%;"
                                            converter="tagConverter" var="tag"
                                            value="#{tagBean.parentTag}"
                                            completeMethod="#{tagBean.findTagByName}"
                                            itemLabel="#{tag.name}" itemValue="#{tag}"
                                            emptyMessage="No se encontraron tags relacionados"
                            >
                            </p:autoComplete>
                        </div>

                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <h:outputLabel for="name" value="Nombre Tag:" style="font-weight:bold"/>
                            <p:inputText id="name" value="#{tagBean.nameTag}" label="Name"/>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                            <h:panelGrid columns="2" cellpadding="5" style="margin-left: 20px">
                                <h:outputText value="Color Fondo: "/>
                                <p:colorPicker value="#{tagBean.colorBackground}"/>


                                <p:dialog modal="true" widgetVar="dlg" showEffect="fade" hideEffect="fade"
                                          header="Seleccione un color de fondo" resizable="false">
                                    <h:panelGrid id="grid" columns="2" cellpadding="5">
                                        <h:outputText value="Popup color: "/>
                                        <h:outputText value="#{tagBean.colorBackground}"
                                                      style="background-color: \##{tagBean.colorBackground}"/>
                                    </h:panelGrid>
                                </p:dialog>
                            </h:panelGrid>

                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                            <h:panelGrid columns="2" cellpadding="5" style="margin-left: 20px">
                                <h:outputText value="Color Texto: "/>
                                <p:colorPicker value="#{tagBean.colorText}"/>


                                <p:dialog modal="true" widgetVar="dlg" showEffect="fade" hideEffect="fade"
                                          header="Seleccione un color de letra" resizable="false">
                                    <h:panelGrid id="grid2" columns="2" cellpadding="5">
                                        <h:outputText value="Popup color: "/>
                                        <h:outputText value="#{tagBean.colorText}"
                                                      style="background-color: \##{tagBean.colorText}"/>
                                    </h:panelGrid>
                                </p:dialog>
                            </h:panelGrid>

                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-1">
                            <p:commandButton value="Crear Tag" process="@this,create"
                                             actionListener="#{tagBean.createTag}" update="create">

                            </p:commandButton>
                        </div>
                    </div>
                </p:panel>
                <p:spacer></p:spacer>
                <h3>Buscar tag por nombre</h3>
                <p:spacer></p:spacer>
                <div class="ui-g">

                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                        <p:autoComplete id="inputFindTag" scrollHeight="200" size="5" style="width: 80%;"
                                        inputStyle="width: 80%;"
                                        converter="tagConverter" var="tag"
                                        value="#{tagBean.tagSelected}"
                                        completeMethod="#{tagBean.findTagByName}"
                                        itemLabel="#{tag.name}" itemValue="#{tag}"
                                        emptyMessage="No se encontraron tags relacionados"
                        >
                        </p:autoComplete>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-6">

                    </div>
                </div>
                <p:spacer></p:spacer>
                <h3>Lista de tag </h3>
                <p:spacer></p:spacer>
                <div class="ui-g">

                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                        <p:selectOneMenu id="tagslist" value="#{tagBean.tag}">

                            <f:selectItems value="#{tagBean.tagList}" var="tag" itemLabel="#{tag.name}"
                                           itemValue="#{tag}"/>
                            <p:column style="width:10%">
                                <h:outputText value="#{tag.name}"/>
                            </p:column>
                        </p:selectOneMenu>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-6">


                    </div>
                </div>
                <p:spacer></p:spacer>

                <h3>Adminsitrar tag</h3>
                <p:spacer></p:spacer>
                <div class="ui-g">

                    <p:dataTable
                            emptyMessage="No existen tags."
                            id="adminTag"
                            style="margin: 10px;"
                            value="#{tagBean.tagList}"
                            var="tag">


                        <p:column headerText="Nombre">
                            <h:outputText value="#{tag.name}"/>
                        </p:column>

                        <p:column headerText="Color fondo" style="width:60px;text-align: center;">
                            <p:colorPicker value="#{tag.colorBackground}"></p:colorPicker>
                        </p:column>
                        <p:column headerText="Color Texto" style="width:60px;text-align: center;">
                            <p:colorPicker value="#{tag.colorLetter}"></p:colorPicker>
                        </p:column>


                        <p:column headerText="vincular" style="width:80px;text-align: center;">
                            <p:commandButton process="@this" icon="fa fa-link" oncomplete="PF('link').show()"
                                             update=":dialogTag:linkPanel">
                                <f:setPropertyActionListener value="#{tag}"
                                                             target="#{tagBean.tagEdit}"/>
                            </p:commandButton>
                        </p:column>

                        <p:column headerText="desvincular" style="width:80px;text-align: center;">
                            <p:commandButton process="@this" icon="fa fa-chain-broken" oncomplete="PF('unlink').show()"
                                             update=":dialogTag:unlinkPanel">
                                <f:setPropertyActionListener value="#{tag}"
                                                             target="#{tagBean.tagEdit}"/>
                            </p:commandButton>
                        </p:column>


                        <p:column headerText="Eliminar" style="width:60px;text-align: center;">
                            <p:commandButton process="@this" icon="fa fa-trash" title="Eliminar"
                                             oncomplete="PF('removeDialog').show()"
                                             update=":dialogTag:removeDialogPanel">
                                <f:setPropertyActionListener value="#{tag}"
                                                             target="#{tagBean.tagEdit}"/>
                            </p:commandButton>
                        </p:column>


                    </p:dataTable>
                </div>


            </h:form>


            <h:form id="dialogTag">
                <p:dialog widgetVar="link" modal="true" showEffect="fade"
                          hideEffect="fade" resizable="true" style="margin:40px;">
                    <p:outputPanel id="linkPanel" style="text-align:center;">


                        <div class="ui-g">

                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                <p:panel  style="border: hidden; width: 100%;"
                                          rendered="#{tagBean.tagEdit.parentTag==null}">
                                <p:autoComplete id="parentTagLink" scrollHeight="200" size="5" style="width: 80%;"
                                                inputStyle="width: 80%;"
                                                converter="tagConverter" var="tag"
                                                value="#{tagBean.parentTag}"
                                                completeMethod="#{tagBean.findTagByName}"
                                                itemLabel="#{tag.name}" itemValue="#{tag}"
                                                emptyMessage="No se encontraron tags relacionados"
                                />
                                </p:panel>
                                <p:panel  style="border: hidden; width: 100%;"
                                          rendered="#{tagBean.tagEdit.parentTag!=null}">

                                    <p:inputText disabled="true"
                                                 value="#{tagBean.tagEdit.parentTag.name}"></p:inputText>

                                </p:panel>
                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                <div class="ui-g">

                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:autoComplete id="childTagLink" scrollHeight="200" size="5"
                                                        style="width: 80%;"
                                                        inputStyle="width: 80%;"
                                                        converter="tagConverter" var="tag"
                                                        value="#{tagBean.childTag}"
                                                        completeMethod="#{tagBean.findTagByName}"
                                                        itemLabel="#{tag.name}" itemValue="#{tag}"
                                                        emptyMessage="No se encontraron tags relacionados"
                                        >
                                        </p:autoComplete>
                                        <p:commandButton update=":dialogTag:linkPanel,:tags:adminTag"
                                                         icon="fa fa-link"
                                                         actionListener="#{tagBean.link()}">

                                        </p:commandButton>
                                    </div>
                                </div>
                                <div class="ui-g">

                                    <div class="ui-g-12 ui-md-6 ui-lg-12">
                                        <p:dataTable value="#{tagBean.tagEdit.childTag}" var="tag">


                                            <p:column headerText="Nombre">
                                                <h:outputText value="#{tag.name}"/>
                                            </p:column>

                                        </p:dataTable>
                                    </div>
                                </div>
                            </div>


                        </div>

                    </p:outputPanel>
                </p:dialog>

                <p:dialog widgetVar="unlink" modal="true" showEffect="fade"
                          hideEffect="fade" resizable="true" style="margin:40px;" header="Desvincular">
                    <p:outputPanel id="unlinkPanel" style="text-align:center;">

                        <div class="ui-g">
                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                <h3>Padre</h3>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <p:inputText disabled="true"
                                                     value="#{tagBean.tagEdit.parentTag.name}"></p:inputText>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <p:commandButton update="unlinkPanel,:tags:adminTag" icon="fa fa-chain-broken"
                                                         actionListener="#{tagBean.unlinkParent()}">

                                        </p:commandButton>
                                    </div>
                                </div>


                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                <h3>Hijos</h3>
                                <p:dataTable value="#{tagBean.tagEdit.childTag}" var="tag">


                                    <p:column headerText="Nombre">
                                        <h:outputText value="#{tag.name}"/>
                                    </p:column>

                                    <p:column headerText="Desvincular" style="width:80px;text-align: center;">
                                        <p:commandButton update=":dialogTag:unlinkPanel,:tags:adminTag"
                                                         icon="fa fa-chain-broken"
                                                         actionListener="#{tagBean.unlinkChild(tag)}">

                                        </p:commandButton>
                                    </p:column>

                                </p:dataTable>
                            </div>

                        </div>

                    </p:outputPanel>
                </p:dialog>

                <p:dialog widgetVar="removeDialog" modal="true" showEffect="fade"
                          hideEffect="fade" resizable="true" style="margin:40px;">
                    <p:outputPanel id="removeDialogPanel" style="text-align:center;">
                        <h3>Si la etiqueta eliminada tiene etiquetas anidadas, éstas se eliminarán igualmente. ¿Esta seguro de eliminar la etiqueta #{tagBean.tagEdit.name}?</h3>

                        <div class="ui-g">

                            <p:commandButton oncomplete="PF('removeDialog').hide()" update=":tags:adminTag"
                                             actionListener="#{tagBean.deleteTag}" style="text-align: center"
                                             icon="fa fa-trash" value="Eliminar">
                            </p:commandButton>

                            <p:commandButton oncomplete="PF('removeDialog').hide()" style="text-align: center"
                                             icon="fa fa-times" value="Cancelar">
                            </p:commandButton>
                        </div>

                    </p:outputPanel>
                </p:dialog>
            </h:form>
        </p:panel>
    </ui:define>

</ui:composition>