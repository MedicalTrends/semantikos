<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:smtk="http://java.sun.com/jsf/composite/smtk"
                template="/WEB-INF/template/template.xhtml">

    <ui:define name="content">

        <p:panel id="createEdit">
            <h:form id="mainForm" rendered="#{conceptBean.concept!=null}">

                <p:growl id="growl" showDetail="true" showSummary="true"/>
                <p:growl id="editMsgs" showDetail="true"/>
                <!--p:messages autoUpdate="true"></p:messages-->

                <!-- Indicadores -->
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                        <p:outputLabel for="toBeReviewedCheck" value="Indicadores"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-5">
                        <p:selectBooleanCheckbox id="toBeReviewedCheck" itemLabel="Revisar"
                                                 value="#{conceptBean.concept.toBeReviewed}" style="width:40%"/>
                        <p:selectBooleanCheckbox id="toBeConsultatedCheck" itemLabel="Consultar"
                                                 value="#{conceptBean.concept.toBeConsulted}" style="width:40%"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                    </div>
                </div>

                <!-- Tag Semantikos -->
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                        <p:outputLabel for="tagSemantikos" value="Tag Semántikos"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-5">
                        <p:selectOneMenu id="tagSemantikos"
                                         value="#{conceptBean.concept.tagSMTK}"
                                         converter="omnifaces.SelectItemsConverter" style="width:60%">
                            <p:ajax event="itemSelect"
                                    update="@(.terms)"
                                    process="@this" />
                            <f:selectItem itemLabel="Seleccione tipo" itemValue=""/>
                            <f:selectItems value="#{conceptBean.tagSMTKs}" var="tag"
                                           itemValue="#{tag}"/>
                        </p:selectOneMenu>

                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                    </div>
                </div>



                <!--Descripciones FSN y Preferida -->
                <smtk:descriptionDraft description="#{conceptBean.concept.getValidDescriptionFSN()}">
                </smtk:descriptionDraft>

                <smtk:descriptionDraft description="#{conceptBean.concept.getValidDescriptionFavorite()}">
                </smtk:descriptionDraft>

                <!-- Observación -->
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                        <p:outputLabel for="toBeReviewedCheck" value="Observación"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-5">
                        <p:inputTextarea id="observation"
                                         name="observation"
                                         value="#{conceptBean.concept.observation}"
                                         style="width:95%">
                        </p:inputTextarea>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                    </div>
                </div>


                <!-- Etiquetas -->

                <smtk:tags tagslist="#{conceptBean.concept.tags}" ></smtk:tags>

                <!-- Otras descripciones -->
                <smtk:descriptions descriptions="#{conceptBean.concept.getValidDescriptionsButFSNandFavorite()}"
                                   otherTermino="#{conceptBean.otherTermino}"
                                   otherSensibilidad="#{conceptBean.otherSensibilidad}"
                                   otherDescriptionType="#{conceptBean.otherDescriptionType}"
                                   descriptionTypes="#{conceptBean.descriptionTypes}">
                </smtk:descriptions>

                <!--Relaciones -->
                <p:panel id="atributos" header="Atributos" toggleable="true" toggleSpeed="500" closeSpeed="500"
                         widgetVar="panelAtributos" style="margin-bottom:20px">

                    <h:dataTable style="width: 100%;" value="#{conceptBean.category.relationshipDefinitions}"
                                 var="relationshipDefinition">

                        <h:column>

                            <smtk:smtkType
                                    rendered="#{relationshipDefinition.targetDefinition.SMTKType}"
                                    targetDefinition="#{relationshipDefinition.targetDefinition}"
                                    relationshipDefinition="#{relationshipDefinition}"
                                    concept="#{conceptBean.concept}"/>

                            <smtk:helperTableType
                                    rendered="#{relationshipDefinition.targetDefinition.helperTable}"
                                    relationshipDefinition="#{relationshipDefinition}"
                                    targetDefinition="#{relationshipDefinition.targetDefinition}"
                                    concept="#{conceptBean.concept}"/>

                            <smtk:basicType
                                    targetDefinition="#{relationshipDefinition.targetDefinition}"
                                    relationshipDefinition="#{relationshipDefinition}"
                                    concept="#{conceptBean.concept}"
                                    rendered="#{relationshipDefinition.targetDefinition.basicType}"/>

                        </h:column>
                    </h:dataTable>
                </p:panel>


                <!-- Historial -->

                <smtk:history></smtk:history>

                <p:commandButton actionListener="#{conceptBean.saveConcept}"
                                 value="Guardar"
                                 update="growl, mainForm"/>

                <p:commandButton actionListener="#{conceptBean.deleteConcept}"
                                 value="Eliminar" type="submit" process="mainForm"
                                 rendered="#{conceptBean.concept.persistent and not conceptBean.concept.modeled}"
                                 update="growl, mainForm"/>

            </h:form>

            <p:messages id="msg" showDetail="true" showSummary="true">
                <p:effect type="pulsate" event="load" delay="0">
                    <f:param name="mode" value="'show'"/>
                    <f:param name="times" value="'1'"/>
                </p:effect>
            </p:messages>


            <p:confirmDialog id="dialogNameConcept" header="Crear Concepto" widgetVar="dialogNameConcept" global="true"
                             showEffect="fade" hideEffect="fade" closable="false"
                             rendered="#{conceptBean.concept==null}">
                <h:form id="initialForm">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-6 ui-lg-12">
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-6 ui-lg-12">
                                    <h:outputText value="Ingrerse el nombre de su concepto:"/>
                                    <p:outputLabel value="Nombre: " for="NameConcept"/>
                                    <p:inputText id="NameConcept" value="#{conceptBean.favoriteDescription}"/>
                                </div>
                            </div>
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-6 ui-lg-12">
                                    <p:selectOneMenu value="#{conceptBean.categorySelect}">
                                        <f:selectItem itemLabel="Insumos" itemValue="3"/>
                                        <f:selectItem itemLabel="Dispositivos Medicos" itemValue="4"/>


                                        <f:selectItem itemValue="105590001" itemLabel="Fármacos – sustancias" />
                                        <f:selectItem itemValue="1" itemLabel="Medicamento Básico" />
                                        <f:selectItem itemValue="3" itemLabel="Insumos" />
                                        <f:selectItem itemValue="4" itemLabel="Dispositivos Medicos" />
                                        <f:selectItem itemValue="71388002" itemLabel="Procedimiento" />
                                        <f:selectItem itemValue="123037004" itemLabel="Estructura corporal" />
                                        <f:selectItem itemValue="123038009" itemLabel="Espécimen" />
                                        <f:selectItem itemValue="260787004" itemLabel="Objeto físico" />
                                        <f:selectItem itemValue="272379006" itemLabel="evento (evento)" />
                                        <f:selectItem itemValue="362981000" itemLabel="Calificador" />
                                        <f:selectItem itemValue="370115009" itemLabel="Concepto especial" />
                                        <f:selectItem itemValue="373873005" itemLabel="producto biológico/farmacéutico (producto)" />
                                        <f:selectItem itemValue="404684003" itemLabel="Problemas" />
                                        <f:selectItem itemValue="410607006" itemLabel="Organismo" />
                                        <f:selectItem itemValue="419891008" itemLabel="Elemento de registro"  />

                                    </p:selectOneMenu>


                                </div>
                            </div>
                            <p:commandButton actionListener="#{conceptBean.createConcept}" update=":createEdit"
                                             value="Siguiente" onclick="loadAutogenerate()"/>
                        </div>
                    </div>

                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-6 ui-lg-12">
                            <h:outputText value="seleccione el concepto:"/>
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-6 ui-lg-12">
                                    <p:outputLabel value="Nombre: " for="NameConcept"/>
                                    <p:inputText id="idconcept" value="#{conceptBean.idconceptselect}"/>
                                </div>
                            </div>

                            <p:commandButton actionListener="#{conceptBean.createConcept}" update=":createEdit"
                                             value="Editar Concepto"

                            />
                        </div>
                    </div>

                </h:form>
            </p:confirmDialog>
        </p:panel>


        <script type="text/javascript">

            function loadAutogenerate() {

                setTimeout(function () {
                    autogenerate(document.getElementById('initialForm:NameConcept'));
                }, 1000);
            }
            function autogenerate(favorite) {
                categoryName = "#{newConceptMBean.category.name}";
                document.getElementById('mainForm:FSN').value = favorite.value + ' (' + categoryName + ')';


            }

        </script>

    </ui:define>

</ui:composition>